<?php include '/app/public/views/partials/header.php'; ?>
<link rel="stylesheet" type= "text/css" href="public/styles/profile.css">
<link rel="stylesheet" type= "text/css" href="public/styles/welcome.css">
<link rel="stylesheet" type= "text/css" href="public/styles/features.css">
<link rel="stylesheet" type= "text/css" href="public/styles/pets.css">
<link rel="stylesheet" type= "text/css" href="public/styles/nutrition.css">
<link rel="stylesheet" type= "text/css" href="public/styles/addingScreens/delete.css">
<link rel="stylesheet" type="text/css" href="public/styles/editPet.css">
<link rel="stylesheet" type="text/css" href="public/styles/addingScreens/addPetModal.css">
<link rel="stylesheet" type="text/css" href="public/styles/addingScreens/addVaccination.css">

    <title>Nutrition</title>
</head>

<body>
    <div class="wrapper">
        
        <div class="top-bar top-bar-clear">
            <a href="/features?id=<?= $pet['id'] ?>" class="back-arrow">&lt;</a> 
            <h1>Nutrition</h1>
        </div>

        <div class="pet-header-container">
            <div class="pet-photo-circle">
                <img src="<?= $pet['picture_url'] ? $pet['picture_url'] : 'public/img/default_pet.png' ?>" alt="<?= $pet['name'] ?>">
            </div>
            <div class="pet-name-display"><?= $pet['name'] ?></div>
        </div>

        <div class="card-container-welcome">
            
            <div class="card-welcome nutrition-card">
                <div class="card-header">
                    <img src="public/img/alert.png" class="status-icon">
                    <span class="card-title alert-text">Sensitivities</span>
                </div>
                <div class="tag-container">
                    <?php foreach ($sensitivities as $s): ?>
                        <span class="tag alert-tag">
                            <?= $s['food'] ?>
                            <span data-id="<?= $s['id'] ?>" 
                                  data-action="/deleteSensitivities"
                                  onclick="prepareDelete(this.dataset.id, this.dataset.action)" style="cursor:pointer;">x</span>
                        </span>
                    <?php endforeach; ?>
                    <button class="tag alert-tag" onclick="openModal('sensitivitiesModal')" style="cursor:pointer; border:none;">+</button>
                </div>
            </div>

            <div class="card-welcome nutrition-card">
                <div class="card-header">
                    <img src="public/img/check.png" class="status-icon">
                    <span class="card-title success-text">Favorite food</span>
                </div>
                <div class="tag-container">
                    <?php foreach ($favorites as $f): ?>
                        <span class="tag success-tag">
                            <?= $f['food'] ?>
                            <span data-id="<?= $f['id'] ?>" 
                                  data-action="/deleteFavorite"
                                  onclick="prepareDelete(this.dataset.id, this.dataset.action)" style="cursor:pointer;">x</span>
                        </span>
                    <?php endforeach; ?>
                    <button class="tag success-tag" onclick="openModal('favoriteModal')" style="cursor:pointer; border:none;">+</button>
                </div>
            </div>

            <div class="card-welcome nutrition-card">
                <div class="card-header">
                    <img src="public/img/pill.png" class="status-icon">
                    <span class="card-title purple-text">Supplements</span>
                </div>
                <div class="tag-container">
                    <?php foreach ($supplements as $sup): ?>
                        <span class="tag purple-tag">
                            <?= $sup['supplement_name'] ?>
                            <span data-id="<?= $sup['id'] ?>" 
                                  data-action="/deleteSupplements"
                                  onclick="prepareDelete(this.dataset.id, this.dataset.action)" style="cursor:pointer;">x</span>
                        </span>
                    <?php endforeach; ?>
                    <button class="tag purple-tag" onclick="openModal('supplementsModal')" style="cursor:pointer; border:none;">+</button>
                </div>
            </div>

            <div class="card-welcome nutrition-card schedule-card">
                <div class="card-header">
                    <img src="public/img/clock.png" class="status-icon">
                    <span class="card-title blue-text">Feeding schedule</span>
                    <button onclick="openModal('scheduleModal')" class="tag blue-tag" style="border:none; cursor:pointer;">+</button>
                </div>
                <div class="schedule-list">
                    <?php foreach ($schedule as $sch): ?>
                        <div class="schedule-item">
                            <span><?= $sch['name'] ?></span>
                            <div class="schedule-actions">
                                <span class="time"><?= date('H:i', strtotime($sch['feeding_time'])) ?></span>
                                
                                <img src="public/img/edit_blue.png" 
                                     class="edit-schedule-icon"
                                     data-id="<?= $sch['id'] ?>"
                                     data-name="<?= $sch['name'] ?>"
                                     data-time="<?= date('H:i', strtotime($sch['feeding_time'])) ?>"
                                     onclick="openEditScheduleModal(this.dataset.id, this.dataset.name, this.dataset.time)">
                                
                                <img src="public/img/delete.png" 
                                     class="edit-schedule-icon"
                                     data-id="<?= $sch['id'] ?>"
                                     data-action="/deleteSchedule"
                                     onclick="prepareDelete(this.dataset.id, this.dataset.action)">
                            </div>
                        </div>
                    <?php endforeach; ?>
                </div>
            </div>
        </div>

        <div id="sensitivitiesModal" class="modal-overlay">
            <div class="modal-content wrapper">
                <form method="POST" action="/addSensitivities?id=<?= $pet['id'] ?>">
                    <div class="modal-header-actions">
                        <button type="button" class="action-btn close-btn" onclick="closeModal('sensitivitiesModal')">
                            <img src="public/img/cancel.png" alt="Close">
                        </button>
                        <div class="right-actions">
                            <button type="submit" class="action-btn save-btn">
                                <img src="public/img/confirm.png" alt="Save">
                            </button>
                        </div>
                    </div>
                    <div class="input-group vaccination-name-group">
                        <label class="input-label">Food (Sensitivity)</label>
                        <div class="container">
                            <input type="text" name="name" placeholder="Chicken" required>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div id="favoriteModal" class="modal-overlay">
            <div class="modal-content wrapper">
                <form method="POST" action="/addFavorite?id=<?= $pet['id'] ?>">
                    <div class="modal-header-actions">
                        <button type="button" class="action-btn close-btn" onclick="closeModal('favoriteModal')">
                            <img src="public/img/cancel.png" alt="Close">
                        </button>
                        <div class="right-actions">
                            <button type="submit" class="action-btn save-btn">
                                <img src="public/img/confirm.png" alt="Save">
                            </button>
                        </div>
                    </div>
                    <div class="input-group vaccination-name-group">
                        <label class="input-label">Favorite Food</label>
                        <div class="container">
                            <input type="text" name="name" placeholder="Beef" required>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div id="supplementsModal" class="modal-overlay">
            <div class="modal-content wrapper">
                <form method="POST" action="/addSupplements?id=<?= $pet['id'] ?>">
                    <div class="modal-header-actions">
                        <button type="button" class="action-btn close-btn" onclick="closeModal('supplementsModal')">
                            <img src="public/img/cancel.png" alt="Close">
                        </button>
                        <div class="right-actions">
                            <button type="submit" class="action-btn save-btn">
                                <img src="public/img/confirm.png" alt="Save">
                            </button>
                        </div>
                    </div>
                    <div class="input-group vaccination-name-group">
                        <label class="input-label">Supplement Name</label>
                        <div class="container">
                            <input type="text" name="name" placeholder="Omega-3" required>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div id="scheduleModal" class="modal-overlay">
            <div class="modal-content wrapper">
                <form method="POST" action="/editSchedule?id=<?= $pet['id'] ?>">
                    <input type="hidden" name="schedule_id" id="scheduleModalId" value="">

                    <div class="modal-header-actions">
                        <button type="button" class="action-btn close-btn" onclick="closeModal('scheduleModal')">
                            <img src="public/img/cancel.png" alt="Close">
                        </button>
                        <div class="right-actions">
                            <button type="submit" class="action-btn save-btn">
                                <img src="public/img/confirm.png" alt="Save">
                            </button>
                        </div>
                    </div>
                    <div class="input-group vaccination-name-group">
                        <label class="input-label">Meal Name</label>
                        <div class="container">
                            <input type="text" name="name" id="scheduleModalName" placeholder="Canned cat food" required>
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Time</label>
                        <div class="row-layout">
                            <div class="container dose-input-small time">
                                <input type="time" name="time" id="scheduleModalTime" value="<?= date('H:i') ?>" required>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div id="deleteModal" class="modal-overlay">
            <div class="modal-box">
                <h3>Are you sure?</h3>
                <p>Do you really want to delete this item?</p>
                <div class="modal-buttons">
                    <button type="button" class="btn-cancel" onclick="closeModal('deleteModal')">Cancel</button>
                    <form id="deleteForm" method="POST" style="margin:0;">
                        <input type="hidden" name="id" id="modalItemId" value="">
                        <button type="submit" class="btn-delete">Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <script src="public/scripts/deleteAddWindow.js" defer></script>
    <script src="public/scripts/deleteNutrition.js" defer></script>
    
</body>
</html>